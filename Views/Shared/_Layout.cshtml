@using Microsoft.AspNetCore.Hosting
@inject IWebHostEnvironment Env

<!DOCTYPE html>
<html lang="pt-br" class="h-full">
<head>


  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
  <meta http-equiv="Pragma" content="no-cache"/>
  <meta http-equiv="Expires" content="0"/>

  <script>
    (function () {
      try {
        var ls = localStorage.getItem('theme');
        var dark = ls ? (ls === 'dark') : window.matchMedia('(prefers-color-scheme: dark)').matches;
        var html = document.documentElement;

        html.setAttribute('data-no-transitions', '');

        if (dark) html.classList.add('dark'); else html.classList.remove('dark');
        html.style.colorScheme = dark ? 'dark' : 'light';
      } catch (e) {
      }
    })();
  </script>

  <style>
    :root[data-no-transitions] *,
    :root[data-no-transitions] *::before,
    :root[data-no-transitions] *::after {
      transition: none !important;
      animation: none !important;
    }
  </style>

  <style>html[data-hide] body {
      visibility: hidden;
    }</style>
  <script>document.documentElement.setAttribute('data-hide', '');</script>
  <script>
    window.addEventListener('load', function () {
      document.documentElement.removeAttribute('data-hide');
      document.documentElement.removeAttribute('data-no-transitions');
    });
  </script>

  <title>@(ViewData["Title"] ?? "WebApp")</title>
  <style>[x-cloak]{display:none!important}</style>
  <vite entry="src/main.ts"/>
</head>


<body class="h-full bg-gray-50 dark:bg-neutral-900 text-gray-800 dark:text-neutral-100">

<header
  class="sticky top-0 z-50 bg-white/90 backdrop-blur border-b dark:bg-neutral-900 dark:border-neutral-800 transition-[margin] duration-300"
  data-layout-shift>
  <div class="max-w-full px-4 sm:px-6 lg:px-8 h-14 flex items-center justify-between">
    <a href="/" class="font-bold text-lg">Minha App</a>

    <button id="theme-toggle"
            class="flex items-center justify-center w-9 h-9 p-0 leading-none rounded-lg border border-gray-300 text-gray-700 bg-white hover:bg-gray-100
                 dark:border-neutral-700 dark:text-neutral-200 dark:bg-neutral-800 dark:hover:bg-neutral-700 transition">
      <svg id="icon-sun"
           class="w-5 h-5 block dark:hidden shrink-0"
           xmlns="http://www.w3.org/2000/svg"
           viewBox="0 0 24 24"
           fill="none" stroke="currentColor" stroke-width="2"
           stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="5"></circle>
        <path
          d="M12 1v2m0 18v2M23 12h-2M3 12H1m16.95 7.95-1.41-1.41M6.46 6.46 5.05 5.05m12.9 0-1.41 1.41M6.46 17.54l-1.41 1.41"/>
      </svg>

      <svg id="icon-moon"
           class="w-5 h-5 hidden dark:block shrink-0"
           xmlns="http://www.w3.org/2000/svg"
           viewBox="0 0 24 24"
           fill="none" stroke="currentColor" stroke-width="2"
           stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
      </svg>
    </button>
  </div>

</header>

<div class="lg:hidden py-16 text-center">
  <button type="button"
          class="py-2 px-3 inline-flex justify-center items-center gap-x-2 text-start bg-gray-800 border border-gray-800 text-white text-sm font-medium rounded-lg shadow-2xs align-middle hover:bg-gray-950 focus:outline-hidden focus:bg-gray-900 dark:bg-white dark:text-neutral-800 dark:hover:bg-neutral-200 dark:focus:bg-neutral-200"
          aria-haspopup="dialog" aria-expanded="false" aria-controls="hs-sidebar-content-push-to-mini-sidebar"
          aria-label="Toggle navigation"
          data-hs-overlay="#hs-sidebar-content-push-to-mini-sidebar">
    Open
  </button>
</div>

<div id="hs-sidebar-content-push-to-mini-sidebar"
     class="hs-overlay [--auto-close:lg] hs-overlay-minified:w-13 lg:block lg:translate-x-0 lg:end-auto lg:bottom-0 w-64
              hs-overlay-open:translate-x-0 -translate-x-full transition-all duration-300 transform
              h-full hidden overflow-x-hidden fixed top-0 start-0 bottom-0 z-60
              bg-white border-e border-gray-200 dark:bg-neutral-800 dark:border-neutral-700"
     role="dialog" tabindex="-1" aria-label="Sidebar">
  <div class="relative flex flex-col h-full max-h-full ">
    <!-- Header -->
    <header class="py-4 px-2  flex justify-between items-center gap-x-2">
      <a
        class="flex-none font-semibold text-xl text-black focus:outline-hidden focus:opacity-80 dark:text-white hs-overlay-minified:hidden"
        href="#" aria-label="Brand">Brand</a>

      <div class="lg:hidden">
        <button type="button"
                class="flex justify-center items-center gap-x-3 size-6 bg-white border border-gray-200 text-sm text-gray-600 hover:bg-gray-100 rounded-full disabled:opacity-50 disabled:pointer-events-none focus:outline-hidden focus:bg-gray-100 dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-400 dark:hover:bg-neutral-700 dark:focus:bg-neutral-700 dark:hover:text-neutral-200 dark:focus:text-neutral-200"
                data-hs-overlay="#hs-sidebar-content-push-to-mini-sidebar">
          <svg class="shrink-0 size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 6 6 18"/>
            <path d="m6 6 12 12"/>
          </svg>
          <span class="sr-only">Close</span>
        </button>
      </div>
      <div class="hidden lg:block">
        <button type="button"
                class="flex justify-center items-center flex-none gap-x-3 size-9 text-sm text-gray-600 hover:bg-gray-100 rounded-full disabled:opacity-50 disabled:pointer-events-none focus:outline-hidden focus:bg-gray-100 dark:text-neutral-400 dark:hover:bg-neutral-700 dark:focus:bg-neutral-700 dark:hover:text-neutral-200 dark:focus:text-neutral-200"
                aria-haspopup="dialog" aria-expanded="false"
                aria-controls="hs-sidebar-content-push-to-mini-sidebar"
                aria-label="Minify navigation"
                data-hs-overlay-minifier="#hs-sidebar-content-push-to-mini-sidebar">
          <svg class="hidden hs-overlay-minified:block shrink-0 size-4" xmlns="http://www.w3.org/2000/svg" width="24"
               height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
               stroke-linejoin="round">
            <rect width="18" height="18" x="3" y="3" rx="2"/>
            <path d="M15 3v18"/>
            <path d="m8 9 3 3-3 3"/>
          </svg>
          <svg class="hs-overlay-minified:hidden shrink-0 size-4" xmlns="http://www.w3.org/2000/svg" width="24"
               height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
               stroke-linejoin="round">
            <rect width="18" height="18" x="3" y="3" rx="2"/>
            <path d="M15 3v18"/>
            <path d="m10 15-3-3 3-3"/>
          </svg>
          <span class="sr-only">Navigation Toggle</span>
        </button>
      </div>
    </header>
    
    @{
      // Helpers para estado ativo
      Func<string, string, bool> IsActive = (ctrl, act) =>
      {
        var curCtrl = ViewContext.RouteData.Values["controller"]?.ToString();
        var curAct  = ViewContext.RouteData.Values["action"]?.ToString();
        return string.Equals(curCtrl, ctrl, StringComparison.OrdinalIgnoreCase)
               && (string.IsNullOrEmpty(act) || string.Equals(curAct, act, StringComparison.OrdinalIgnoreCase));
      };

      Func<bool, string> ActiveClasses = (active) => active
        ? "bg-gray-100 text-gray-900 dark:bg-neutral-700 dark:text-white"
        : "text-gray-800 hover:bg-gray-100 dark:bg-neutral-800 dark:hover:bg-neutral-700 dark:text-neutral-200";
    }

    <nav
      class="h-full overflow-y-auto [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300 dark:[&::-webkit-scrollbar-track]:bg-neutral-700 dark:[&::-webkit-scrollbar-thumb]:bg-neutral-500">
      <div class=" pb-0 px-2  w-full flex flex-col flex-wrap">
        <ul class="space-y-1">
          <li>
            <a href="@Url.Action("Index", "Home")"
               class="min-h-[36px] flex items-center gap-x-3.5 py-2 px-2.5 text-sm rounded-lg @(ActiveClasses(IsActive("Home","Index")))">
              <ui-icon name="home" class="size-4" />
              <span class="hs-overlay-minified:hidden">Dashboard</span>
            </a>
          </li>

          <li>
            <a href="@Url.Action("Index", "Docs")"
               class="min-h-[36px] w-full flex items-center gap-x-3.5 py-2 px-2.5 text-sm rounded-lg @(ActiveClasses(IsActive("Docs","Index")))">
              <ui-icon name="calendar" class="size-4" />
              <span class="text-nowrap hs-overlay-minified:hidden">Api</span>
            </a>
          </li>

          <li>
            <a href="@Url.Action("Index", "Artwork")"
               class="min-h-[36px] w-full flex items-center gap-x-3.5 py-2 px-2.5 text-sm rounded-lg @(ActiveClasses(IsActive("Artwork","Index")))">
              <ui-icon name="artwork" class="size-4" />
              <span class="text-nowrap hs-overlay-minified:hidden">Cadastrar Obras</span>
            </a>
          </li>
        </ul>
      </div>
    </nav>
  </div>
</div>

<main class="flex-1 max-h-full p-5 overflow-hidden overflow-y-auto bg-gray-100 dark:bg-neutral-800" data-layout-shift>
  <div class="border-b dark:border-b-neutral-700 pb-4">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3">
      <div class="flex items-center gap-2 min-w-0">
        @RenderSection("PageIcon", false)
        <h1 class="text-xl font-semibold md:text-2xl truncate">
          @(ViewData["Title"] ?? "Página")
        </h1>
      </div>

      <div class="flex flex-col w-full gap-2 md:w-auto md:flex-row">
        @RenderSection("HeaderButtons", false)
      </div>
    </div>

    <div class="mt-3">
      @await Component.InvokeAsync("Breadcrumb")
    </div>
  </div>

  <div class="py-4">
    @RenderSection("Alerts", false)
    <div class="rounded-xl border border-gray-200 dark:border-neutral-800 bg-white dark:bg-neutral-900 p-6">
      @RenderBody()
    </div>
  </div>
</main>

@RenderSection("Scripts", false)

<script asp-src-include="~/js/layout-sync.js" asp-append-version="true"></script>
<script asp-src-include="~/js/thema-toggle.js" asp-append-version="true"></script>

<script>
  window.addEventListener('load', function () {
    document.documentElement.removeAttribute('data-no-transitions');
  });
</script>

<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

</body>
</html>
